<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2026衆院選 政策シミュレーター</title>

<!-- Chart.js & Bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<style>
    body { background-color: #f0f2f5; font-family: "Helvetica Neue", Arial, sans-serif; }
    .header-area { background: #1a237e; color: white; padding: 20px 0; margin-bottom: 25px; border-bottom: 4px solid #f1c40f; }
    .simulator-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); margin-bottom: 20px; transition: transform 0.2s; }
    .result-box { background: #e8f5e9; color: #2e7d32; padding: 20px; border-radius: 8px; margin-top: 15px; border-left: 5px solid #2ecc71; }
    .param-label { font-weight: bold; color: #444; font-size: 0.95rem; }
    #plot-area { width: 100%; min-height: 350px; }
    .btn-about { border: 1px solid white; color: white; font-size: 0.85rem; }
    .party-tag { font-size: 0.8em; padding: 3px 8px; border-radius: 4px; color: white; margin-right: 5px; display: inline-block; }
    
    /* 政党カラー */
    .bg-jimin { background-color: #d32f2f; } /* 自民・維新 */
    .bg-rikken { background-color: #1976d2; } /* 中道改革 */
    .bg-kokumin { background-color: #fbc02d; color: black; } /* 国民民主 */
    .bg-mirai { background-color: #8e44ad; } /* チームみらい */
    .bg-kyosan { background-color: #880e4f; } /* 共産・れいわ */
</style>
</head>
<body>

<!-- Header -->
<div class="header-area">
    <div class="container d-flex justify-content-between align-items-center">
        <div>
            <h4 class="m-0 fw-bold">🗳️ 2026衆院選 政策シミュレーター</h4>
            <small class="opacity-75">物理法則で未来を予測する</small>
        </div>
        <button class="btn btn-sm btn-about" data-bs-toggle="modal" data-bs-target="#aboutModal">
            ⓘ 解説
        </button>
    </div>
</div>

<div class="container">
    <div class="row">
        <!-- Input Panel -->
        <div class="col-lg-5 mb-3">
            <div class="simulator-card">
                <h6 class="mb-4 border-bottom pb-2 fw-bold">🎛️ あなたが望む日本の設計図</h6>
                
                <!-- 消費税 -->
                <div class="mb-4">
                    <label class="param-label">消費税率（生活必需品を含む）</label>
                    <input type="range" class="form-range" id="tax_rate" min="0" max="15" value="10" step="1" oninput="updateVal('val_tax', this.value, '%')">
                    <div class="d-flex justify-content-between small text-muted">
                        <span>廃止 (0%)</span>
                        <span id="val_tax" class="fw-bold text-primary fs-5">10%</span>
                        <span>増税 (15%)</span>
                    </div>
                </div>

                <!-- 財政出動 -->
                <div class="mb-4">
                    <label class="param-label">投資の規模と財源戦略</label>
                    <input type="range" class="form-range" id="fiscal_spend" min="0" max="3" value="1" step="1" oninput="updateFiscalLabel(this.value)">
                    <div class="d-flex justify-content-between small text-muted">
                        <span>緊縮・維持</span>
                        <span id="val_fiscal" class="fw-bold text-primary">現状維持</span>
                        <span>積極投資</span>
                    </div>
                    <small id="fiscal_desc" class="d-block mt-1 text-secondary" style="font-size:0.8em">バランス重視の予算配分</small>
                </div>

                <!-- 社会保障・分配 -->
                <div class="mb-4">
                    <label class="param-label">社会保障・分配の仕組み</label>
                    <select class="form-select form-select-sm" id="social_wall">
                        <option value="keep">現状維持 (既存の社会保障)</option>
                        <option value="reform_centrist">食料品税ゼロ・社保減 (中道改革)</option>
                        <option value="reform_high">178万円の壁撤廃 (国民民主)</option>
                        <option value="system_opt">システム最適化 (チームみらい)</option>
                    </select>
                </div>

                <!-- 防衛・外交 -->
                <div class="mb-4">
                    <label class="param-label">防衛・外交スタンス</label>
                    <div class="btn-group w-100" role="group">
                        <input type="radio" class="btn-check" name="defense" id="def_peace" value="peace">
                        <label class="btn btn-outline-secondary btn-sm" for="def_peace">対話・現実外交</label>

                        <input type="radio" class="btn-check" name="defense" id="def_status" value="status" checked>
                        <label class="btn btn-outline-secondary btn-sm" for="def_status">専守防衛</label>

                        <input type="radio" class="btn-check" name="defense" id="def_strong" value="strong">
                        <label class="btn btn-outline-secondary btn-sm" for="def_strong">防衛力強化</label>
                    </div>
                </div>

                <!-- エネルギー -->
                <div class="mb-4">
                    <label class="param-label">エネルギー政策</label>
                    <div class="btn-group w-100" role="group">
                        <input type="radio" class="btn-check" name="energy" id="ene_renew" value="renew">
                        <label class="btn btn-outline-secondary btn-sm" for="ene_renew">再エネ・脱原発</label>

                        <input type="radio" class="btn-check" name="energy" id="ene_mix" value="mix" checked>
                        <label class="btn btn-outline-secondary btn-sm" for="ene_mix">原発再稼働・安定</label>
                        
                        <input type="radio" class="btn-check" name="energy" id="ene_tech" value="tech">
                        <label class="btn btn-outline-secondary btn-sm" for="ene_tech">次世代技術投資</label>
                    </div>
                </div>

                <button onclick="runSimulation()" class="btn btn-primary w-100 fw-bold shadow-sm py-2">
                    シミュレーション実行 🚀
                </button>
            </div>
        </div>

        <!-- Result Panel -->
        <div class="col-lg-7">
            <div class="simulator-card">
                <h6 class="mb-3 border-bottom pb-2 fw-bold">📊 5年後の日本経済予測 (SBCM分析)</h6>
                <div id="chart-container" style="position: relative; height:300px;">
                    <canvas id="resultChart"></canvas>
                </div>
                
                <div id="result-text" class="result-box">
                    <strong>☝️ 政策を選択して実行してください。</strong><br>
                    「ジャパン・ファンド」や「食料品税ゼロ」などの最新政策が、家計の「保持率」にどう影響するか計算します。
                </div>
                
                <div class="mt-3 text-end">
                     <a id="twitter-share" href="#" target="_blank" class="btn btn-sm btn-dark disabled">
                        Twitterで結果をシェア
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- About Modal (解説部分のみ改訂) -->
<div class="modal fade" id="aboutModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">2026年衆院選：各勢力の物理モデル解説</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body small">
                <p>このシミュレーターは、各党の公約を「思想」ではなく、社会OSを動かすための**「物理パラメータ」**として解釈し、5年後の日本を演算します。</p>
                
                <div class="mb-3">
                    <strong>🔴 与党（自民・維新）：成長・防衛投資モデル</strong><br>
                    既存のインフラと防衛力を強化し、太いパイプ（大型予算）で経済を回します。安定感はありますが、中央集権的な「漏出（中抜き）」による熱損失が課題となります。
                </div>

                <div class="mb-3">
                    <strong>🔵 中道改革連合（立憲・公明等）：低摩擦・直接支援モデル</strong><br>
                    「食料品税ゼロ」と「社保減」により、家計の抵抗（摩擦）を直接除去します。ジャパン・ファンドで外部エネルギーを取り込み、将来負担を抑えつつ広域循環を目指します。
                </div>

                <div class="mb-3">
                    <strong>🟡 国民民主党：高圧経済・手取り最大化モデル</strong><br>
                    「178万円の壁」撤廃により、現役世代の電圧（可処分所得）を一気に上げます。消費を爆発させるブースターになりますが、財政的な過負荷への耐性が焦点となります。
                </div>

                <div class="mb-3">
                    <strong>🚀 チームみらい：超伝導・システム最適化モデル</strong><br>
                    デジタルと数理により行政の「歪み」を徹底排除します。追加のエネルギー（増税や借金）を最小限に抑え、システムの効率化のみで実質出力を上げるエンジニアリング特化型です。
                </div>

                <div class="mb-3">
                    <strong>🟣 野党共闘（共産・れいわ）：最大出力・反緊縮モデル</strong><br>
                    消費税廃止と大規模な国債発行で、システムに最大のエネルギーを注入します。短期的には強力な「救済」となりますが、インフレによる「システムの溶融（熱的死）」リスクを伴います。
                </div>

                <hr>
                <p class="text-muted">※本シミュレーターはSBCM（標準ブロック比較法）の理論に基づき、因果律を計算しています。スローガンではなく、ロジックで未来を選択してください。</p>
            </div>
        </div>
    </div>
</div>

<script>
    let myChart = null;

    function updateVal(id, val, suffix) {
        document.getElementById(id).innerText = val + suffix;
    }

    function updateFiscalLabel(val) {
        const labels = ["緊縮・維持", "バランス投資", "政府系ファンド活用", "積極財政"];
        const descs = [
            "現状維持。財政規律を重視。",
            "インフラ更新・防災へ重点投資。",
            "ジャパン・ファンド等の運用益を原資に投資。",
            "国債発行による大規模な産業支援。"
        ];
        document.getElementById("val_fiscal").innerText = labels[val];
        document.getElementById("fiscal_desc").innerText = descs[val];
    }

    function runSimulation() {
        const taxRate = parseFloat(document.getElementById("tax_rate").value);
        const fiscalLvl = parseInt(document.getElementById("fiscal_spend").value);
        const socialWall = document.getElementById("social_wall").value;
        const defense = document.querySelector('input[name="defense"]:checked').value;
        const energy = document.querySelector('input[name="energy"]:checked').value;

        const baseIncome = 460; 
        const baseInflation = 1.5; 
        
        let incomeScore = 0; 
        let inflationScore = 0; 
        let distortionScore = 1.0; 
        let futureBurden = 0; 

        // A. 税制の影響 (痛みの保存則)
        incomeScore += (10 - taxRate) * 1.5;
        if (taxRate < 5) {
            futureBurden += (5 - taxRate) * 12; 
            inflationScore += (5 - taxRate) * 0.25; 
        }

        // B. 財政出動の影響 (漏出の定理)
        if (fiscalLvl === 0) { 
            incomeScore -= 5;
            inflationScore -= 0.5;
        } else if (fiscalLvl === 1) { 
            incomeScore += 5;
            futureBurden += 5;
        } else if (fiscalLvl === 2) { // ジャパン・ファンド活用
            incomeScore += 12;
            futureBurden += 2; // 運用益活用のため国債依存が低い
            distortionScore += 0.05; 
        } else if (fiscalLvl === 3) { 
            incomeScore += 18;
            inflationScore += 2.5;
            distortionScore += 0.4;
            futureBurden += 40;
        }

        // C. 社会保障・中道改革の新ロジック反映
        if (socialWall === 'reform_high') { 
            incomeScore += 25; 
            futureBurden += 20; 
        } else if (socialWall === 'reform_centrist') { // 中道改革: 食料品ゼロ・社保減
            incomeScore += 18; // 実質手取りの直接的向上
            distortionScore -= 0.1; // 複雑な給付事務より税率ゼロの方が摩擦が少ない
            futureBurden += 8; // 社保減収分。ファンドで補填する想定
        } else if (socialWall === 'system_opt') { 
            incomeScore += 15; 
            distortionScore -= 0.3; 
        }

        // D. 外交・エネルギー
        if (defense === 'strong') futureBurden += 10;
        if (energy === 'tech') futureBurden += 5;

        // 最終計算
        const finalIncome = baseIncome + (incomeScore / distortionScore) - (inflationScore * 6);
        const finalInflation = baseInflation + inflationScore;
        const finalDistortion = distortionScore;

        // 3. 政党マッチングロジック
        let bestMatch = "該当なし";
        let partyColor = "#7f8c8d";
        let partyDesc = "独自の政策ミックスです。";

        // 🔵 中道改革連合 (食料品ゼロ・社保減・ファンド)
        if (socialWall === 'reform_centrist' || (taxRate <= 10 && fiscalLvl === 2)) {
            bestMatch = "🔵 中道改革連合 (立憲・公明等)";
            partyColor = "#1976d2";
            partyDesc = "「食料品税ゼロ」と「社保減」で現役・生活者を直接支援。ジャパン・ファンドで将来負担を抑えつつ、広域での経済循環を目指す低摩擦モデルです。";
        }
        // 🔴 与党 (自民・維新)
        else if (defense === 'strong' && energy === 'mix' && fiscalLvl >= 1) {
            bestMatch = "🔴 自民・維新 連立政権";
            partyColor = "#d32f2f";
            partyDesc = "「強い日本」を掲げる安定・防衛重視路線。既存インフラの強化と成長投資を優先しますが、中央集権的な漏出リスクは残ります。";
        }
        // 🟡 国民民主党
        else if (socialWall === 'reform_high') {
            bestMatch = "🟡 国民民主党";
            partyColor = "#fbc02d";
            partyDesc = "「手取り最大化」を最優先。基礎控除引き上げで現役世代の電圧を一気に上げますが、財政的なインピーダンス（抵抗）への対策が課題です。";
        }
        // 🚀 チームみらい
        else if (socialWall === 'system_opt') {
            bestMatch = "🚀 チームみらい";
            partyColor = "#8e44ad";
            partyDesc = "システムの根本修理。デジタルによる中抜き排除で、追加予算なしで実質出力を最大化する「超伝導」統治モデルです。";
        }
        // 🟣 共産・れいわ
        else if (taxRate <= 5 && fiscalLvl === 3) {
            bestMatch = "🟣 野党共闘 (共産・れいわ)";
            partyColor = "#880e4f";
            partyDesc = "消費税の大幅減税と国債による大規模給付。短期的エネルギーは最大ですが、制御不能なインフレ（熱的死）の懸念が物理的に指摘されます。";
        }

        // 4. チャート描画
        const ctx = document.getElementById('resultChart').getContext('2d');
        if (myChart) myChart.destroy();

        const dataIncome = Math.round(finalIncome);
        const dataInf = finalInflation.toFixed(1);
        const dataDist = finalDistortion.toFixed(2);

        myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['実質手取り(年収)', 'インフレ率', '行政の歪み(熱損失)'],
                datasets: [{
                    label: '予測値',
                    data: [dataIncome/baseIncome*100, (dataInf/baseInflation)*100, dataDist*100],
                    backgroundColor: [
                        dataIncome >= baseIncome ? '#2ecc71' : '#e74c3c',
                        dataInf > 3.0 ? '#e74c3c' : '#3498db',
                        dataDist > 1.15 ? '#e74c3c' : '#3498db'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                scales: { y: { beginAtZero: false, min: 30, max: 180, ticks: { display: false } } },
                plugins: { legend: { display: false } }
            }
        });

        // 5. 結果表示
        const diff = Math.round(finalIncome - baseIncome);
        const sign = diff > 0 ? "+" : "";
        
        let html = `<h5 style="color:${partyColor}">${bestMatch}</h5>`;
        html += `<p class="small">${partyDesc}</p>`;
        html += `<hr>`;
        html += `<div class="row text-center">`;
        html += `<div class="col-4"><strong>手取り</strong><br><span class="fs-5">${dataIncome}万</span><br><small class="${diff>0?'text-success':'text-danger'}">(${sign}${diff})</small></div>`;
        html += `<div class="col-4"><strong>インフレ</strong><br><span class="fs-5">${dataInf}%</span></div>`;
        html += `<div class="col-4"><strong>歪み指数</strong><br><span class="fs-5">${dataDist}</span></div>`;
        html += `</div>`;

        if(finalDistortion < 0.95) {
            html += `<div class="mt-3 p-2 bg-success bg-opacity-25 rounded small text-dark">✅ <strong>SBCM評価:</strong> 効率的な「抵抗除去」が行われています。実質的な購買力が維持されやすい構造です。</div>`;
        } else if(futureBurden > 30) {
            html += `<div class="mt-3 p-2 bg-danger bg-opacity-25 rounded small text-dark">⚠️ <strong>SBCM警告:</strong> 将来世代へのエントロピー蓄積が深刻です。持続可能性にバグが発生しています。</div>`;
        }

        document.getElementById("result-text").innerHTML = html;

        const tweetText = `私の政策シミュレーション結果：\n【${bestMatch}】\n💰手取り：${dataIncome}万円 (${sign}${diff})\n📈インフレ：${dataInf}%\n🤖歪み指数：${dataDist}\n\n#2026衆院選 #SBCMシミュレーター`;
        const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(tweetText)}`;
        const btn = document.getElementById("twitter-share");
        btn.href = url;
        btn.classList.remove("disabled", "btn-dark");
        btn.classList.add("btn-primary");
    }
</script>

</body>
</html>
